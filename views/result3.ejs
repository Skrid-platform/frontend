<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Skrid</title>
    <link rel="stylesheet" href="./styles/semantic.min.css" />
    <link rel="stylesheet" href="./styles/style.css" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css">

    <!-- shim -->
    <script src="./inc/shim/Base64.js" type="text/javascript"></script>
    <script src="./inc/shim/Base64binary.js" type="text/javascript"></script>
    <script src="./inc/shim/WebAudioAPI.js" type="text/javascript"></script>
    <script src="./inc/shim/WebMIDIAPI.js" type="text/javascript"></script>
    <!-- jasmid package -->
    <script src="./inc/jasmid/stream.js"></script>
    <script src="./inc/jasmid/midifile.js"></script>
    <script src="./inc/jasmid/replayer.js"></script>
    <!-- midi.js package -->
    <script src="./js/midi/audioDetect.js" type="text/javascript"></script>
    <script src="./js/midi/gm.js" type="text/javascript"></script>
    <script src="./js/midi/loader.js" type="text/javascript"></script>
    <script src="./js/midi/plugin.audiotag.js" type="text/javascript"></script>
    <script src="./js/midi/plugin.webaudio.js" type="text/javascript"></script>
    <script src="./js/midi/plugin.webmidi.js" type="text/javascript"></script>
    <script src="./js/midi/player.js" type="text/javascript"></script>
    <script src="./js/midi/synesthesia.js" type="text/javascript"></script>
    <!-- utils -->
    <script src="./js/util/dom_request_xhr.js" type="text/javascript"></script>
    <script src="./js/util/dom_request_script.js" type="text/javascript"></script>
    <!-- includes -->
    <script src="./inc/timer.js" type="text/javascript"></script>
    <script src="./inc/event.js" type="text/javascript"></script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.min.js"></script>
    <script src="https://unpkg.com/vexflow/releases/vexflow-debug.js"></script>
    <script src="./scripts/verovio-toolkit.js" type="text/javascript"></script>

    <script src="./scripts/MIDIPlayer.js"></script>
</head>
<%- include('./partials/header'); %>
<body>
  <div class="searchbar-box">
    <br><br>
    <h1 class="searchbar-title">Recherchez ton  partition musicale préférée !</h1>
    <form>
      <input type="text" placeholder="Search...">
      <button type="submit">Search</button>
    </form>
  </div>
  <div id="app" class="panel" style="border: 1px solid lightgray; min-height: 800px;"></div>
</body>
<footer>
  <%- include('./partials/footer'); %>
</footer>

</body>

<script id="viewer" type="module">
  import 'https://editor.verovio.org/javascript/app/verovio-app.js';
  
  const datadir = "./data/JosephMahe/";
  const score_name = "Air_n_1.mei";
  const options = {
    defaultView: 'reponsive', // instead of 'document' by default
    defaultZoom: 2 // 0-7, default is 3
  }
  // Create the app - here with an empty option object
  var app = new Verovio.App(document.getElementById("app"), {options});

  // Load a file (MEI or MusicXML)
  fetch(datadir+score_name)
      .then(function(response) {
        console.log(response.text())
          return response.text();
      })
      .then(function(text) {
          app.loadData(text);
      });
</script>

<script>
  /*
  document.addEventListener("DOMContentLoaded", init);
  //const corpusFiles= ["Air_n_1", "Air_n_2", "Air_n_3", "Air_n_4", "Air_n_5", "Air_n_6", "Air_n_7", "Air_n_8", "Air_n_9", "Air_n_11", "Air_n_12", "Air_n_13", "Air_n_14", "Air_n_15", "Air_n_16", "Air_n_17", "Air_n_18", "Air_n_19", "Air_n_21", "Air_n_22", "Air_n_24", "Air_n_25", "Air_n_26", "Air_n_27", "Air_n_28", "Air_n_29", "Air_n_31", "Air_n_32", "Air_n_33", "Air_n_34", "Air_n_35", "Air_n_36", "Air_n_37", "Air_n_38", "Air_n_39"];
  const datadir = "./data/JosephMahe/";
  const score_name = "Air_n_1.mei";
  //const archivesCommunName="MaheFiles";

  
  function reply_click(clicked_object)  {

    const options = {
    defaultView: 'reponsive', // instead of 'document' by default
    defaultZoom: 2 // 0-7, default is 3
    }

    // Create the app - here with an empty option object
    app = new Verovio.App(document.getElementById("app"), {options});

    // Load a file (MEI or MusicXML)
    fetch(clicked_object.getAttribute('filename'))
      .then(function(response) {
      return response.text();
      })
      .then(function(text) {
        app.loadData(text);
      });
  }

  function init() {
    var vrvToolkit = new verovio.toolkit();
    let errMsg = false;
    var pathmusicxml = datadir+score_name;

    fetch(pathmusicxml)
        .then(function(response) {
            return response.text();
        })
        .then((xml) => {
          vrvToolkit.loadData(xml);
	      });

    //var errMsg = vrvToolkit.loadData('./data/JosephMahe/Air_n_2.mei');

    if (!errMsg) {
      var options = {
        scale: 50,
        adjustPageHeight: true,
        pageMarginTop: 50,
        pageMarginBottom: 50
      };
      vrvToolkit.setOptions(options);

      var svg = vrvToolkit.renderToSVG(1, {});
      
      var container = document.getElementById("app");
      container.innerHTML = svg;
    } else {
      console.error(errMsg);
    }
  }*/
</script>
</html>